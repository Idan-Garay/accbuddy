<!DOCTYPE html>
<html lang="en">

    <head>
        
    </head>

    <body>
        
  <script>
    // JavaScript code goes here
    document.addEventListener('DOMContentLoaded', function() {
    // Page is fully loaded
    let productsDescription = [];
    let productsQty = [];
    let productsDescriptionTimestamp = 0
    let productCatalogUpdateTimestamp = 0
    const backendUrl = `https://api.accbuddy.com/public`
    let productsDescriptionStorage = localStorage.getItem('productsDescription');
    let productsQtyStorage = localStorage.getItem('productsQty');
    let productUpdateTimestampStorage = localStorage.getItem('productUpdateTimestamp');
    let productCatalogUpdateTimestampStorage = localStorage.getItem('productCatalogUpdateTimestamp');
    if(productsQtyStorage){
        productsQty = JSON.parse(productsQtyStorage);
        
    }
    if(productsDescriptionStorage){
        productsDescription = JSON.parse(productsDescriptionStorage);
    
    }
    if(productUpdateTimestampStorage){
        
        productsDescriptionTimestamp = JSON.parse(productUpdateTimestampStorage);
        
    }
    if(productCatalogUpdateTimestampStorage){
        
        productCatalogUpdateTimestamp = JSON.parse(productCatalogUpdateTimestampStorage);
        
    }
    let payload = {
        fetchProductsDescription:{
            timestamp:productsDescriptionTimestamp
        }
    
    }
    fetch(backendUrl, {
        method: 'POST',
        body: JSON.stringify(payload)
    })
        .then(response => response.json())
        .then(data=> data.result)
        .then(responseProducts=>{
            console.log(JSON.stringify(responseProducts))
            productsDescription = [...productsDescription,...responseProducts]
            console.log(JSON.stringify(productsDescription))
            const timestamps = productsDescription.map(product=>product.productUpdateTimestamp)
            console.log(timestamps)
            const timestamp = Math.max(...timestamps)
            console.log(timestamp)
            localStorage.setItem('productUpdateTimestamp',JSON.stringify(timestamp))
            localStorage.setItem('productsDescription',JSON.stringify(productsDescription))
        })
    payload = {
        fetchProductsPriceQty:{
            timestamp:productCatalogUpdateTimestamp
        }
    
    }
    fetch(backendUrl, {
        method: 'POST',
        body: JSON.stringify(payload)
    })
        .then(response => response.json())
        .then(data=> data.result)
        .then(responseProducts=>{
            
            productsQty = [...productsQty,...responseProducts]
            const timestamps = productsQty.map(product=>product.productCatalogUpdateTimestamp)
            const timestamp = Math.max(...timestamps)
            console.log(JSON.stringify(productsQty))
            localStorage.setItem('productsQty',JSON.stringify(productsQty))
            localStorage.setItem('productCatalogUpdateTimestamp',JSON.stringify(timestamp))
        })
    
    // Add event listener for mousemove
    document.addEventListener('mousemove', function() {
        // Mouse moved, do something
        console.log('Mouse moved');
        // Call your desired function or perform any actions you want
    });
    });
  </script>
    </body>

</html>
